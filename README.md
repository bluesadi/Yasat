# Yasat - Yet Another Static Analysis Tool to detect cryptographic API misuses in firmware

This is my undergraduate capstone project, and my very first attempt to develop a project using 
[angr](https://github.com/angr/angr). Thanks for angr's developers for offering such a powerful tool!

Yasat's aims are as follows:
- Minimize the false alarm rate
- Provide an accurate bird's-eye view of the number and severity of cryptographic misuses in firmware
- Try to exploit some misuses found in firmware

## Development progress
- [x] A skeleton of intra-procedural BackwardSlicing
- [x] Make it able to handle global variables
- [ ] Refine [SimEngineBackwardSlicing](Yasat/analyses/backward_slicing/engine_ail.py)
  - [x] Test on binary operation test cases (34/34)
  - [x] Test on unary operation test cases (4/4)
  - [ ] ...
- [x] Make it inter-procedural
- [ ] Make it able to handle some standard functions (e.g., memcpy, malloc)
- [ ] ...

## Misuse types targeted by Yasat

- Constant encryption keys
- Constant salts for password-based encryption (PBE)
- // TODO

## Installation

Python virtual environment is highly recommended as Yasat is based on angr, which is a tool usually used in a virtual environment (see [Installing angr](https://docs.angr.io/introductory-errata/install)). Let's create a virtual environment first:

```
mkvirtualenv --python=$(which python3) Yasat
```

Install [binwalk](https://github.com/ReFirmLabs/binwalk) in the virtual environment you just created:
```
workon Yasat
git clone https://github.com/ReFirmLabs/binwalk.git
cd binwalk
sudo `which python` setup.py install
cd ..
sudo rm -rf binwalk
```

Then install other required packages:
```
pip install -r requirements.txt
```

## Usage

**Configuration:** Yasat's behavior is fully controlled by the configuration file, which you can specify by `-c` option. If not specified, Yasat will use [config.yml](config.yml) by default. 

**Multiprocessing:** Use `-p` option to specify the maximum CPU cores for analyzing input files. Set this option to `1` if you do not want to use multiprocessing. The default number is half of the CPU cores of your machine.
```
python run.py [-c <config>] [-p <processes>]
```

## Test

You may use our test cases generated by [Yasat-TestsGenerator](Yasat-TestsGenerator) to examine Yasat. Just type `pytest` command in project's root directory.
```
$ pytest
====================================== test session starts ======================================
platform linux -- Python 3.8.10, pytest-7.2.1, pluggy-1.0.0
rootdir: /home/bluesadi/Yasat, configfile: pytest.ini, testpaths: tests
plugins: anyio-3.6.2
collected 38 items                                                                              

tests/test_binary_operations.py ..................................                        [ 89%]
tests/test_unary_operations.py ....                                                       [100%]

================================ 38 passed in 166.04s (0:02:46) =================================
```